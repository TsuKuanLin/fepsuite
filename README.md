###FEP-ABFE: free-energy perturbation with absolute binding free energy calculation

# Prepration

Before running the script, prepare mdtraj package for python3.
```sh
% pip3 install mdtraj --user
```

In some supercomputers (like Univ. Tokyo) you may not be able to access `$HOME` from computation nodes. For these exotic systems, you need to install python packages into non-default directories, and you need to set `PYTHONPATH` correctly. Please consult the sysadmin of your system how to do that (I am not your sysadmin and I won't do anything).

Make sure you can import `mdtraj` from python3 properly.

```sh
% python3 -c "import mdtraj"
```
If above command fails, consult your sysadmin.
I do not support the cases that you need the cross compilation. Again, consult your sysadmin for such cases.

Also, you need `zsh` to be installed. You can check by, for example:
```sh
% zsh -c "echo ZSH works"
```

# Calculating the free energy
Then, follow the next order to run the FEP-ABFE.

1. Prepare topology with protein + ligand + water + ions of you want to calculate. If you are starting from the structure generated by docking, please see the latter section before proceeding the calculation.
2. Set topology file name as `topol_ionized.top` and coorinate file as `conf_ionized.pdb` or `conf_ionized.gro`. (You can use symlink for that).
3. Prepare a directory with two depths, e.g. `abfecalc/mol1`. Put topology and structure files under `abfecalc/mol1`.
4. Clone this git repository to somewhere, e.g. `$HOME/repos/fep-abfe`.
5. Copy `para_conf.zsh`, and an appropriate submission script under `example_submit_script` to `abfecalc/`. 
6. Modify submission script's `ABFE_ROOT` to git repository root such as `$HOME/repos/fep-abfe`.
7. Modify `para_conf.zsh` according to your calculation environment.
8. Move to `abfecalc` directory, e.g. `cd $HOME/abfecalc`. 
9. Run the submission script with secondary directory name (in this case `mol1`) and `all`, e.g. `./titech_tsubame3.zsh mol1 all`. 
10. Wait until calculation finishes.
11. If everything works fine, output should be generated at `abfecalc/mol1/result.txt`.

# How to interpret the result
```
annihilation -15.339 0.226
charging 3.002 0.057
restrain -0.621 0.036
total -12.958 0.236
```
Lines except the final line represent contributions from each component of the free energy.
Left component in the final line (`-12.958`) is the total binding free energy in kcal/mol.
Right numnber (`0.236`) represents the standard deviation estimated from the data (in kcal/mol).

# Starting from docking results
Typically, poses obtained from docking simulation are not stable.


# Caveats (TODO)

